<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>乐其英语|乐在其中</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/res/layui/css/layui.css">
	<link rel="stylesheet" href="/res/static/css/mian.css">
	<link rel="stylesheet" href="/res/static/css/weiaudio.css">
	<script src="/res/layui/layui.js">

	</script>
	<script src="/res/static/js/leqisoft.js"></script>
	<script src="/js/jquery-3.2.1.js"></script>
	<script src="/res/static/js/weixinAudio.js"></script>
	<script>
        var layer;
        var englishArray = Array()

        layui.config({
            base: '/res/static/js/'
        }).use(['layer', 'blog', 'jquery'], function () {


            var $ = layui.jquery;

            layer = layui.layer

            layer.load(2);
            $(document).ready(function () {

                var id = getURLValue("id")
                var word = getURLValue("word")
                $("title").html(word);
                $("#title").append($("<a href='#'>" + word+ "</a>"))
                //loadSegments($, id)
               // loadShortWord($, id)
                loadWord($,word)
                loadSentence($,id)

            })
        });

        //加载Content下的所有
        function loadSegments($, id) {
            $.ajax({
                timeout: 4000, //超时时间设置，单位毫秒
                url: "/segment/findById?id=" + id,
                type: "GET",
                success: function (data) {
                    var segment = $.parseJSON(data.data)

                    $("#title").append($("<a href='#'>" + segment.title + "</a>"))
                    if (isIn(segment.updateDate, 1000 * 60 * 60)) {
                        $("#lunchDate").append($("<span>刚刚</span>"))
                    } else {
                        $("#lunchDate").append($("<span>" + getSmpFormatDateByLong(segment.updateDate, true) + "</span>"))
                    }

                    $("#audioTitle").text("src", segment.title)
                    initWeiXinAudion(segment.audioPath)
                    splitContent($, segment.content)
                    layer.closeAll('loading');
                    openDownloadApp()
                },
                error: function (data) {
                    layer.alert('sorry,请过会从新加载', {icon: 5});
                    openDownloadApp()
                }
            })
        }

        function loadShortWord($, id) {
            $.ajax({
                timeout: 4000, //超时时间设置，单位毫秒
                url: "/shortWord/findBySegmentId?segmentId=" + id,
                type: "GET",
                success: function (data) {
                    var shortWords = $.parseJSON(data.data)

                    showShortWord(shortWords)

                },

            })
        }

        function showShortWord(shortWords) {
            for (var i = 0; i < shortWords.length; i++) {
                var shortWord = shortWords[i]
                var shortWordRoot = $(" <div class='layui-row'></div>")
                var title = $("<p ><span style='font-size: 18px;font-weight: bold'>"+(i+1)+"." + shortWord.word + "</span></p>")
                var info = $("<p ><span style='font-size: 14px;color:dimgray'>" + shortWord.info + "</span></p>")
                shortWordRoot.append(title,info)
                loadSentence(shortWord.id,shortWordRoot)
                $("#shortWordContainer").append(shortWordRoot)
            }
        }

        function loadSentence($,wordId) {
            $.ajax({
                timeout: 4000, //超时时间设置，单位毫秒
                url: "/sentence/findByWordId?wordId=" + wordId,
                type: "GET",
                success: function (data) {
                    var sentences = $.parseJSON(data.data)


                    for (var i = 0 ; i < sentences.length ; i++){
                        var sen = sentences[i]
                        var english = $("<p ><span style='font-size: 14px'>"+(i+1)+"." + sen.english + "</span></p>")
                        var chinese = $("<p ><span style='font-size: 12px ; color: dimgray'>" + sen.chinese + "</span></p>")
                        $("#sentences").append(english,chinese);
                    }

                },

            })
        }

        function loadWord($,wordId) {
            $.ajax({
                timeout: 4000, //超时时间设置，单位毫秒
                url: "/english/word/findByWord?word=" + wordId,
                type: "GET",
                success: function (data) {
                    var word = $.parseJSON(data.data)

                    $("#prounce").append(createProuncePane($,word))
					addMeans($,word.means,$("#means"))
                    layer.closeAll('loading');

                },

            })
        }
        /**
         *   public static final String SLIP_TIME_AND_TEXT = "-->";
         public static final String SLIP_START_AND_END = "==>";
         public static final String SLIP_EN_AND_CH = ">::<";
         public static final String SLIP_END = "<=====>";
         public static final String SLIP_SENTENCE = "\n";
         * @param $
         * @param english
         * @param chinish
         * @returns {*|jQuery|HTMLElement}
         */

        function splitContent($, content) {
            var arr = content.split("\n")
            englishArray = Array(arr.length)
            for (var i = 0; i < arr.length; i++) {
                var scentence = arr[i]
                var subarr = scentence.split(">::<");
                var ch = ""
                if (subarr.length == 2) {
                    ch = subarr[1]
                }

                var english = subarr[0]
                var endsubarr = english.split("-->")
                var startTime = 0
                var endTime = 0
                if (endsubarr.length == 2) {
                    english = endsubarr[1]
                    var text = endsubarr[0]
                    var startAndEndTimeArr = text.split("==>")

                    if (startAndEndTimeArr.length == 2) {
                        startTime = startAndEndTimeArr[0]
                        endTime = startAndEndTimeArr[1]
                    }

                } else {
                    english = ""
                }

                var title = $("<p ><span style='font-size: 18px'>" + english + "</span></p>")
                var chinese = $("<p><span style='font-size: 13px;color: dimgrey'>" + ch + "</span></p>")

                englishArray[i] = {
                    node: title,
                    startTime: startTime,
                    endTime: endTime

                }
                $("#container").append(title, chinese)
            }
        }


        function initWeiXinAudion(path) {
            $('.weixinAudio').weixinAudio({
                autoplay: false,
                src: '/file/download?path=' + path,
                currentTimeChange: function (time) {
                    for (var i = 0; i < englishArray.length; i++) {
                        var startTime = englishArray[i].startTime
                        var endTime = englishArray[i].endTime
                        var node = englishArray[i].node

                        if (time >= startTime && time <= endTime) {
                            node.css("color", "red")
                        } else {
                            node.css("color", "black")
                        }
                    }
                }
            });
        }


	</script>
</head>
<body class="lay-blog">
<audio hidden id="wordAudio" controls="controls" >

</audio>

<div class="header">
	<div class="header-wrap">
		<h1 class="logo pull-left">
			<a href="/html/index.html">
				<img src="/res/static/images/logo.png" alt="" class="logo-img">
				<img src="/res/static/images/logo-text.png" alt="" class="logo-text">
			</a>
		</h1>
		<form class="layui-form blog-seach pull-left" action="">
			<div class="layui-form-item blog-sewrap">
				<div class="layui-input-block blog-sebox">
					<i class="layui-icon layui-icon-search"></i>
					<input type="text" name="title" lay-verify="title" autocomplete="off" class="layui-input">
				</div>
			</div>
		</form>
		<div class="blog-nav pull-right">
			<ul class="layui-nav pull-left">
				<li class="layui-nav-item layui-this"><a href="/html/index.html">首页</a></li>
				<li class="layui-nav-item"><a href="/html/message.html">留言</a></li>
				<li class="layui-nav-item"><a href="/html/about.html">关于</a></li>
			</ul>
			<a href="#" class="personal pull-left">
				<i class="layui-icon layui-icon-username"></i>
			</a>
		</div>
		<div class="mobile-nav pull-right" id="mobile-nav">
			<a href="javascript:;">
				<i class="layui-icon layui-icon-more"></i>
			</a>
		</div>
	</div>
	<ul class="pop-nav" id="pop-nav">
		<li><a href="/html/index.html">首页</a></li>
		<li><a href="/html/message.html">留言</a></li>
		<li><a href="/html/about.html">关于</a></li>
	</ul>
</div>

<div class="container-wrap">

	<div class="container container-message container-details">
		<div class="contar-wrap">
			<div class="item">
				<div class="item-box  layer-photos-demo1 layer-photos-demo">
                     <span class="layui-breadcrumb" id="navigation">
  <a href="/html/index.html">首页</a>
  <a href="">segments</a>
  <a href="">亚太地区</a>

</span>
					<h3 id="title"></h3>

					<p></p>

					<div class="contar-wrap" id="container">
						<div class='layui-row' id="prounce" >

						</div>

						<div class='layui-row' id="means" >

						</div>

						<div class='layui-row' >
							<h3>双语例句</h3>
						</div>

						<div class='layui-row' id="sentences" >

						</div>

					</div>



				</div>
			</div>


		</div>
	</div>
</div>
<div class="footer">
	<p>
		<span id="time">&copy; 2018</span>
		<span>&copy; 2018</span>
		<span><a href="http://www.layui.com" target="_blank">layui.com</a></span>
		<span>MIT license</span>
	</p>
	<p><span>人生就是一场修行</span></p>
</div>

</body>
</html>